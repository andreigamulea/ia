<h1>Testare Conexiune Debian</h1>

<!-- Afișare cheie de criptare (doar pentru testare) -->
<p>Cheia de criptare: <%= @encryption_key %></p>

<!-- Player Video.js -->
<video id="my-video" class="video-js vjs-default-skin" controls preload="auto" crossorigin="anonymous"></video>

<!-- Include stilurile și scripturile Video.js -->
<script src="https://cdn.jsdelivr.net/npm/videojs-http-streaming@latest/dist/videojs-http-streaming.min.js"></script>
<link href="https://vjs.zencdn.net/7.20.3/video-js.css" rel="stylesheet" />
<script src="https://vjs.zencdn.net/7.20.3/video.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initializează playerul Video.js fără sursă la început
    var player = videojs('my-video', {
        controls: true,
        preload: 'auto',
        techOrder: ['html5']
    });

    // Configurare MediaSource Extensions
    if ('MediaSource' in window) {
        var mediaSource = new MediaSource();
        player.src({
            src: URL.createObjectURL(mediaSource),
            type: 'video/mp4'
        });

        mediaSource.addEventListener('sourceopen', function() {
            var sourceBuffer = mediaSource.addSourceBuffer('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');

            // Fetch and append video segments
            fetch('https://ayush.go.ro/natura1.mp4')  // Fișierul video pe care vrei să-l încarci
                .then(response => response.arrayBuffer())
                .then(data => {
                    sourceBuffer.appendBuffer(data);  // Adaugă segmentul în bufferul de redare
                    sourceBuffer.addEventListener('updateend', function() {
                        console.log('Segment video încărcat în buffer');
                    });
                })
                .catch(error => console.error('Eroare la încărcarea fișierului video:', error));
        });

        player.on('error', function() {
            var error = player.error();
            console.error('Eroare apărută în player:', error.code, error.message);
        });

        player.on('loadedmetadata', function() {
            console.log("Fișierul video a fost încărcat cu succes.");
        });

        player.on('playing', function() {
            console.log("Video-ul este redat.");
        });

        player.on('pause', function() {
            console.log("Video-ul a fost întrerupt.");
        });

        player.on('ended', function() {
            console.log("Video-ul s-a terminat.");
        });
    } else {
        console.error('MediaSource nu este suportat în acest browser.');
    }
});
</script>
